<div id="global_body">
    
      <div class="step_box" id="step_1"><img src="/themes/default/imgs/flow/step-3.gif"/></div>
<%if flash[:info]%>
<div class="tip_box"><%=flash[:info]%></div>
<%end%>
        
      <div class="cart_title"> <span>我的购物车</span>

  <p style="display:none;">有问题？请查看<a href="/article.php?id=334" target="_blank">帮助中心</a>，或联系客服 400-88-16016</p>
</div>
<div class="cart_box" style="padding-bottom:0;">
  <table width="100%" border="0" cellpadding="0" cellspacing="0" class="cart_item_top">
    <tr>
      <td width="370" align="center">商品名称</td>
      <td width="159">单价</td>

      <td width="109">数量</td>
      <td width="121">花费积分</td>
      <td width="199">小计</td>
    </tr>
  </table>
<%=raw gen_shoppingcart%>  
  
  
</div>

<script type="text/javascript" charset="utf-8">
$(document).ready(function(){
$('.packed').hover(function(){
  $(this).find('.packed_list').show();
  }, function(){
  $(this).find('.packed_list').hide();
  });
  $('#cart_item').find('.goods_tr:first').find('td').css('border-top','none');
  $('#cart_item').find('.goods_tr:last').find('td').css('border-bottom','1px solid #e2e2e2');
  if($('#cart_item').find('.goods_tr:last').next().hasClass("gift_tr"))
  {
    $('#cart_item').find('.goods_tr:last').find('td').css('border-bottom','none');	
  }
  $('#cart_item').find('.gift_tr').find('td').css('border-bottom','none');
  $('#cart_item').find('.gift_tr:last').find('td').css('border-bottom','1px dashed #FF9A03');
  $('.packed_in').find('td').css('border-bottom','none');
});
/* 增减购买数量 */
function addorminus(opr,goods_id,rec_id)
{
      var goods_id=goods_id.replace(/,/g,"")
var new_val = $('#num_input_' + goods_id + '_' + rec_id).val();
  switch(opr)
  {
  case "add":
    $('#num_input_' + goods_id + '_' + rec_id).val(parseInt(new_val) + 1);
    $('#num_input_' + goods_id + '_' + rec_id).focus();
    $('#num_input_' + goods_id + '_' + rec_id).blur();
    break
  case "minus":
  if (new_val >=2)
  {
    $('#num_input_' + goods_id + '_' + rec_id).val(parseInt(new_val) - 1);
    $('#num_input_' + goods_id + '_' + rec_id).focus();
    $('#num_input_' + goods_id + '_' + rec_id).blur();
  }
  break
  default:
  }
}

</script>
<%if !has_product?%>
      <br />
<br />
<br />
<br />
<%else%>
<div class="cart_btn">
<%= raw show_pop()%>

      <table width="100%" border="0" cellpadding="0" cellspacing="0">
    <tr>
      <td width="40%" align="right" valign="middle"></td>
      <%if has_login?%>
              <td width="60%" height="78" align="left" valign="middle" class="check_td"><a href="/shopping/checkout"><img src="/themes/default/imgs/flow/checkout_btn.gif" width="142" height="36" /></a><span>如果您有优惠券/礼品卡，请在下一步结账过程中使用</span></td>
<%else%>
      <td width="60%" height="78" align="left" valign="middle"><a class='loginpop_btn' style="cursor: pointer;"><img src="/themes/default/imgs/flow/checkout_btn.gif" width="142" height="36" /></a></td>
<%end%>
    </tr>
  </table>
</div>
<%end%>
<div class="pop_out"  id="login_pop" style="height:auto;">
<div class="do_box pop" style="height:476px; position:relative;">
    <div class="close">关闭</div>
     <dl class="do_top">
    	<dt style="border-bottom-width:1px;"><img src="/themes/default/imgs/ucenter/login_title.gif" width="72" height="17" /></dt>
        <dd style="border-bottom-width:1px;"></dd>   
        <div class="close">关闭</div>     
        <div class="clear"></div>

    </dl><div class="clear"></div> 
    <div class="table_box">
    <form action="/usercenter/login?back_url=/shopping/cart" method="post" name="loginForm" id="loginForm">
     <input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
   <table width="463" border="0" cellpadding="0" cellspacing="0" class="do_list" style="margin-top:25px;">
      <tr>
        <td width="90" height="46" align="right" valign="middle"><span class="login_item">Email:</span></td>
        <td width="245" valign="middle">
        <div class="mailline">
        <input class="do_input uemail s_input" type="text" name="username" id="login_user" value="" autocomplete="off" />

        <dl class="maillist" style="width:225px; top:28px;">
        	<dt style="width:215px;">请选择邮箱类型</dt>
            <dd class="inputmail" style="width:215px;"></dd>
            <dd style="width:215px;" addr="163.com">@163.com</dd>
            <dd style="width:215px;" addr="126.com">@126.com</dd>
            <dd style="width:215px;" addr="263.com">@263.com</dd>
            <dd style="width:215px;" addr="qq.com">@qq.com</dd>

            <dd style="width:215px;" addr="hotmail.com">@hotmail.com</dd>
            <dd style="width:215px;" addr="gmail.com">@gmail.com</dd>
            <dd style="width:215px;" addr="sohu.com">@sohu.com</dd>
            <dd style="width:215px;" addr="chinaren.com">@chinaren.com</dd>
            <dd style="width:215px;" addr="yahoo.com.cn">@yahoo.com.cn</dd>
        </dl><input type="hidden" name="prevIndex" class="prevIndex" value="-1" /> 
        </div>

        </td>
        <td width="" valign="middle"><span></span></td>
      </tr>
      <tr>
        <td height="46" align="right" valign="middle"><span class="login_item">密码:</span></td>
        <td valign="middle"><input class="do_input psd_input s_input" type="password" name="password" id="login_pass"  value="" /></td>
        <td valign="middle"><span></span></td>
      </tr>

      <tr>
        <td height="30" align="right" valign="middle">&nbsp;</td>
        <td valign="middle"><input type="checkbox" checked="checked" checked name="remember"  class="autologin" id="remember" />
        <b><label for="remember">下次自动登录</label></b></td>
        <td valign="middle">&nbsp;</td>
      </tr>
      <tr>
        <td height="56" align="right" valign="middle">&nbsp;</td>

        <td colspan="2" valign="middle">
          <input name="button" value="登&nbsp;录"  type="button"onclick="checkLoginForm($('#loginForm'));" class="submit_btn reglogin_btn" /><span style="margin-left:10px;"></span><a id="forget" class="forget" href="/user.php?act=get_password">忘记密码？</a></td>
      </tr>
      <tr>
        <td height="56" align="right" valign="middle">&nbsp;</td>
        <td colspan="2" valign="middle"><a href="javascript:void(0)" onclick="window.open('http://api.t.sina.com.cn/oauth/authorize?display=popup&oauth_token=1edb9f3cb6274a5f6f09e68e2650058d&oauth_callback=http%3A%2F%2Fwww.geilibuy.com%2Fuser_combine_respond.php');"><img src="/themes/default/imgs/ucenter/sina_btn.gif" width="68" height="24" /></a>&nbsp;&nbsp;&nbsp;&nbsp;<b>您也可以用新浪微博账号登录给力百货</b></td>
      </tr>
      <tr>

        <td height="56" align="right" valign="middle">&nbsp;</td>
        <td colspan="2" valign="top" style="border-top:1px dashed #e2e2e2; padding-top:15px;"><b>还没有给力百货或给力团账号?</b><a class="forget" id="do_other">10秒快速注册 &gt;&gt;</a></td>      
        
      </tr>
    </table>
    <input name="act" type="hidden" value="signin" />  
    <input type="hidden" name="back_act" value="flow.php" />
    </form></div>
  </div>
</div>

<div class="pop_out" id="reg_pop" style="height:auto;">
<div class="do_box pop" style="height:476px; position:relative;">
    <div class="close">关闭</div>
    <dl class="do_top">
    	<dt style="border-bottom-width:1px;"><img src="/themes/default/imgs/ucenter/reg_title.gif" width="89" height="18" /></dt>
        <dd style="border-bottom-width:1px;">您所提供的资料不会做其它用途，请放心填写。</dd>
        <div class="close">关闭</div>
        <div class="clear"></div>        
    </dl><div class="clear"></div>

    <div class="table_box">
    <form action="/usercenter/register?back_url=/shopping/cart" method="post" name="formUser" id="formUser">
     <input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
   <table width="463" border="0" cellpadding="0" cellspacing="0" class="do_list" style="margin-top:25px;">
      <tr>
        <td width="90" height="46" align="right" valign="middle"><span class="login_item">Email:</span></td>
        <td width="245" valign="middle">
        <div class="mailline">
       <input class="do_input uemail s_input" type="text" name="email" id="email" autocomplete="off" />

        <dl class="maillist" style="width:225px; top:28px;">
        	<dt style="width:215px;">请选择邮箱类型 </dt>
            <dd class="inputmail"  style="width:215px;"></dd>
            <dd style="width:215px;" addr="163.com">@163.com</dd>
            <dd style="width:215px;" addr="126.com">@126.com</dd>
            <dd style="width:215px;" addr="263.com">@263.com</dd>
            <dd style="width:215px;" addr="qq.com">@qq.com</dd>

            <dd style="width:215px;" addr="hotmail.com">@hotmail.com</dd>
            <dd style="width:215px;" addr="gmail.com">@gmail.com</dd>
            <dd style="width:215px;" addr="sohu.com">@sohu.com</dd>
            <dd style="width:215px;" addr="chinaren.com">@chinaren.com</dd>
            <dd style="width:215px;" addr="yahoo.com.cn">@yahoo.com.cn</dd>
        </dl><input type="hidden" name="prevIndex" class="prevIndex" value="-1" /> 
        </div>

        </td>
        <td width=" " valign="middle"><span></span></td>
      </tr>
      <tr>
        <td height="46" align="right" valign="middle"><span class="login_item">昵称:</span></td>
        <td valign="middle"><input class="do_input psd_input s_input" type="text" name="nick" id="nick" /></td>
        <td valign="middle"><span></span></td>
      </tr>

      <tr>
        <td height="46" align="right" valign="middle"><span class="login_item">密码:</span></td>
        <td valign="middle"><input class="do_input psd_input s_input" type="password" name="password" id="password" /></td>
        <td valign="middle"><span></span></td>
      </tr>
      <tr>
        <td height="46" align="right" valign="middle"><span class="login_item">确认密码:</span></td>
        <td valign="middle"><input class="do_input psd_input s_input" type="password" name="confirm_password" id="conform_password" /></td>

        <td valign="middle"><span></span></td>
      </tr>
      <!--<tr>-->
      <!--  <td height="46" align="right" valign="middle"><span class="login_item">验证码:</span></td>-->
      <!--  <td valign="middle"><span class="yzm_box" style="width:110px;"><input class="do_input s_input yzm_input" style="width:80px;" type="text"  name="captcha" id="captcha" /></span><img src="captcha.php?" alt="看不清？请点击！" style="vertical-align: middle;cursor: pointer;height:22px;" onClick="this.src='captcha.php?'+Math.random()" /></td>-->
      <!--  <td valign="middle"><span></span></td>-->
      <!--</tr>-->
      <tr>

        <td height="35" align="right" valign="middle">&nbsp;</td>
        <td valign="middle"><input type="checkbox"  id="agreement_input" name="agreement"　class="autologin" value="1" checked="checked"/>
          <b><label for="agreement_input">已阅读并接受</label></b><a class="forget" tabindex="-1" style="margin-left:0;" href="/about/23">《给力百货用户协议》</a></td>
        <td valign="middle"><span></span></td>
      </tr>
      <tr>
        <td height="56" align="right" valign="middle">&nbsp;</td>
        <td colspan="2" valign="middle"><input name="button" value="注&nbsp;册" type="button" class="submit_btn reglogin_btn" onclick="checkSignupForm($('#formUser'))" /></td>

      </tr>
      <tr>
        <td height="56" align="right" valign="middle">&nbsp;</td>
        <td valign="top" style="border-top:1px dashed #e2e2e2; padding-top:15px;"><b>已有给力百货或给力团账号?</b><a class="forget" id="do_other1">立即登录 &gt;&gt;</a></td>
        <td valign="top">&nbsp;</td>
      </tr>
    </table>
    <input name="act" type="hidden" value="signup"/>

    </form> </div>
  </div>
</div>


<form id="sinaweibologinForm" name="sinaweibologinForm" action="user_combine_logreg.php" method="post">
      <input type="hidden" name="wbid" value="" id="wbid" />
      <input type="hidden" name="wbcode" value="" id="wbcode" />
      <input type="hidden" name="wbname" value="" id="wbname" />
      <input type="hidden" name="back_act" value="flow.php" id="back_act" />

    </form>

<SCRIPT type=text/javascript>
$(document).ready(function(){
//登录注册弹出层事件						   
	$(".close").live("click", function(){
		//$("#popbg").hide();
		$(".pop_out").fadeOut();
	});	
	
	$('.loginpop_btn,#do_other1').click(function(){	
	$(".pop_out").fadeOut();
	popdiv("#login_pop","471","auto",0.4);
	
	});		
	$('#do_other').click(function(){	
	$(".pop_out").hide();								 
	popdiv("#reg_pop","471","auto",0.4);	
	
	});	 
						   
						   
	$(".prevIndex").val("0");
	//默认-1
	
	var DdSize=$(".maillist dd").size();
	//.maillist中dd的数量
	
	$(".do_input").focus(function(){		
  		$(this).addClass("on_input");
	}); 
	$(".uemail").focus(function(){		
  		$(this).parent().find('.maillist').find('dd:first').attr("id","dd_0").attr("index",'0').addClass('mail_on');
		$('.do_tip').empty();
		$('.do_tip').removeClass("do_tip error_tip");
		if($(this).val() =="")
		{		
			//$(this).parent().parent().next().find("span").show();
			$(this).parent().parent().next().find("span").removeClass();
			$(this).parent().parent().next().find("span").addClass('help_tip');
			if($(this).attr('id')=="login_user")
			{
				$(this).parent().parent().next().find("span").html("");
			}
			else
			{
				$(this).parent().parent().next().find("span").html("请使用有效邮箱");
			}
			return (false);
		} 		
	}); 
	 
	 $(".uemail").blur(function(){		
  		CheckEmail($(this));		
	}); 	
	 $("#nick").focus(function(){
	  $(this).select();
		if($(this).val() =="")
		{   $(this).parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
			$(this).parent().next().find("span").addClass('help_tip');
			$(this).parent().next().find("span").html("字母,数字下划线或汉字");
			return (false);
		}  
	}); 
	 $("#nick").blur(function(){		
  		CheckNick($(this));
	}); 
	 
	$("#password,#conform_password,#login_pass").focus(function(){
		if($(this).val() =="")
		{   $(this).parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
			$(this).parent().next().find("span").addClass('help_tip');
			if($(this).attr('id')=="login_pass")
			{
				$(this).parent().next().find("span").html("");
			}
			else
			{
				$(this).parent().next().find("span").html("不能少于6位字符");
			}
			
			
			
			return (false);
		}  
	}); 
	$("#password,#login_pass").focus(function(){
		$(this).select();									  	
		
	}); 	
	$("#password,#login_pass,#nick").select(function(){							  	
		$('.maillist').hide();
	});	
	
	$("#password,#conform_password,#login_pass").blur(function(){
		CheckPassword($(this));
	});
	
	$("#conform_password").focus(function(){
		if($(this).val() =="")
		{   $(this).parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
			$(this).parent().next().find("span").addClass('help_tip');
			$(this).parent().next().find("span").html("请再次输入密码");
			return (false);
		}  
	}); 
	$("#conform_password").blur(function(){
		ComparePassword($(this).parent().parent().prev().find("input"),$(this));
	}); 
	
	
	$("#captcha").focus(function(){
		if($(this).val() =="")
		{   $(this).parent().parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
			$(this).parent().parent().next().find("span").addClass('help_tip');
			$(this).parent().parent().next().find("span").html("");
			return (false);
		}  
	});
	
	$("#captcha").blur(function(){
		CheckYzm($(this));
	}); 
	
	$(".do_input").blur(function(){
  		$(this).removeClass("on_input");
	}); 
	
	$(".maillist").hover(function(){
  		
	}, function(){			
		$(this).hide();	
	});
	
	$(".uemail").mousedown(function(){
  		$(this).parent().find('.maillist').hide();
	});
	
	//email的keyup事件操作						
	$(".uemail").keyup(function(event){	
	//过滤回车键	
	//if (window.event.keyCode==13) window.event.keyCode=9;
	if((event.keyCode !=13))
	{
  		$(this).parent().find('.maillist').show();		
		$(this).parent().find('.maillist').find('dd').eq(0).html($(this).val());
		//
		var mtxt="";
		mtxt=$(this).val().split("@");
		var mailregu=$(this).val(); 		 
		var mailre=new RegExp(mailregu);
		var sort=1;			
		$(this).parent().find('.maillist').find('dd').not(':first').each(function(index) { 
			$(this).html(mtxt[0]+"@"+$(this).attr('addr'));					
			if($(this).text().search(mailre)!=-1)
			{
				$(this).show();	
				$(this).attr("id","dd_"+sort).attr("index",sort);	
				sort++;
			}     
			else     
			{   
				$(this).hide();
				$(this).attr("id","").attr("index","");	
			} 
		DdSize=sort;
		});	
		if($(this).parent().find(".prevIndex").val()>sort)
		{
			$(this).parent().find(".prevIndex").val(0);		
		}	
	}
	else
	{	
		$(this).parent().find(".prevIndex").val(0);


		$(this).parent().find('.maillist').find('dd').eq(0).addClass('mail_on').siblings().removeClass('mail_on');		
		$(this).blur();
		$(this).parent().parent().parent().next().find("input").select();
		$(this).parent().parent().parent().next().find("input").focus();
		checkLoginForm($('#loginForm'));
	}
	}); 
	
	//得到焦点文本框光标在最后位置函数
	function setinputfocus(input)
	{  		
		input.blur();
		input.parent().parent().parent().next().find("input").select();
		input.parent().parent().parent().next().find("input").focus();
		checkLoginForm($('#loginForm'));
	}
	//回车相应函数
	function clickDd(currIndex,isme) {
		var prevIndex=isme.parent().find(".prevIndex").val();
		isme.parent().find('.maillist').find("#dd_0").remove("mail_on");
		if(currIndex>-1) {
			isme.parent().find('.maillist').find("#dd_"+currIndex).addClass("mail_on").siblings().removeClass('mail_on');
		}
		isme.parent().find('.maillist').find("#dd_"+prevIndex).removeClass("mail_on");
		isme.parent().find(".prevIndex").val(currIndex);
	}
	
	$(".maillist dd").mouseover(function () {
		//鼠标滑过
		$(this).addClass("mail_on");
		$(this).parent().parent().parent().find('.uemail').val($(this).html());
	}).mouseout(function () {
		//鼠标滑出
		$(this).removeClass("mail_on");
	}).click(function () {
		//鼠标单击
		var prevIndex=parseInt($(this).parent().find(".prevIndex").val());		
		$(this).parent().parent().parent().find('.maillist').hide();
		var emailinput=$(this).parent().parent().parent().find('.uemail').eq(0);		
		setinputfocus(emailinput);	

	});	
	
	//email输入框绑定键盘上下回车键事件
	$(".uemail").bind('keydown','up',function (evt) {
		//↑
		//alert($(this).attr('id'));
		var prevIndex=parseInt($(this).parent().find(".prevIndex").val());
		if(prevIndex==-1||prevIndex==0) {
			clickDd(DdSize-1,$(this));
		}else if(prevIndex>0) {
			clickDd(prevIndex-1,$(this));
		}
		return false;
	}).bind('keydown','down',function (evt) {
		//↓
		var prevIndex=parseInt($(this).parent().find(".prevIndex").val());
		if(prevIndex==-1||prevIndex==(DdSize-1)) {
			clickDd(0,$(this));
		}else if(prevIndex<(DdSize-1)) {
			clickDd(prevIndex+1,$(this));
		}
		return false;
	}).bind('keydown','return',function (evt) {
		//↙
		var prevIndex=parseInt($(this).parent().find(".prevIndex").val());
		$(this).focus();
		$(this).val($(this).parent().find('.maillist').find("#dd_"+prevIndex).html());
		$(this).parent().find('.maillist').hide();
		return false;
	});
	//clickDd(0);	
	$('#loginForm').keydown(function(event){
		if((event.keyCode ==13))
		{
			checkLoginForm($('#loginForm'));
		}
	});
	$('#formUser').keydown(function(event){
		if((event.keyCode ==13))
		{			
			checkSignupForm($('#formUser'));
		}		
	});
	
	
});	

function CheckEmail(Email)
{	//Email.parent().parent().next().find(".do_tip").remove();
	Email.parent().parent().next().find("span").removeClass('error_tip ok_tip help_tip').addClass('do_tip');
	if(Email.val() =="")
	{		
		//Email.parent().parent().next().find(".do_tip").show();
		Email.parent().parent().next().find(".do_tip").addClass('error_tip');
	    Email.parent().parent().next().find(".do_tip").html("不能为空");
	    return (false);
	}    
	var filter=/^\s*([A-Za-z0-9_-]+(\.\w+)*@(\w+\.)+\w{2,3})\s*$/;
    if (!filter.test(Email.val())) 
	{ 
		Email.parent().parent().next().find(".do_tip").addClass('error_tip');
     	Email.parent().parent().next().find(".do_tip").html("格式有误");
       	return (false); 
   	}
	else
	{	
		if($(Email).attr('id')=="login_user")
			{
				Email.parent().parent().next().find(".do_tip").addClass('help_tip');
				Email.parent().parent().next().find(".do_tip").html("");
			}
			else
			{	Email.parent().parent().next().find("span").removeClass();	
				Email.parent().parent().next().find("span").addClass('help_tip');
				Email.parent().parent().next().find("span").html("邮件验证中...");		
				$.ajax({
				   type: "GET",
				   url: "/usercenter/check",
				   data: 'act=check_email&email=' + Email.val() + "&m=" + Math.random(),
				   success:function(msg){
				   if ( msg == 'ok' ){
					   Email.parent().parent().next().find("span").removeClass('help_tip');
					   Email.parent().parent().next().find("span").addClass('do_tip');
					  Email.parent().parent().next().find("span").addClass('ok_tip');
					  Email.parent().parent().next().find("span").html("");
					}
					else
					{
						Email.parent().parent().next().find("span").removeClass('help_tip');
					Email.parent().parent().next().find("span").addClass('do_tip');
					  Email.parent().parent().next().find("span").addClass('error_tip');
					　Email.parent().parent().next().find("span").html("已被注册");
					}
				   }
				  });
			}
			return (false);
		
	    
	}
}
function CheckNick(Nick)
{
	
	var filter=/^[\u4e00-\u9fa5a-zA-Z0-9_]+$/;
    if(Nick.val().length>0)
	{
		if (!filter.test(Nick.val())) 
		{ 
			Nick.parent().next().find("span").removeClass('error_tip ok_tip help_tip').addClass('do_tip');
			Nick.parent().next().find(".do_tip").addClass('error_tip');
			Nick.parent().next().find(".do_tip").html("有非法字符");
			return (false); 
		}
		
		Nick.parent().next().find("span").removeClass('error_tip ok_tip help_tip');
	 	Nick.parent().next().find("span").addClass('do_tip ok_tip');
        Nick.parent().next().find(".do_tip").html("");
	}
	else
	{
		Nick.parent().next().find("span").removeClass('error_tip ok_tip help_tip');
	 	Nick.parent().next().find("span").addClass('do_tip help_tip');
        Nick.parent().next().find(".do_tip").html("");
		
    }
}
function CheckPassword(password)
{	
	if(password.val().length>0)
	{
		if(password.attr('id')!="login_pass")			
			{
				if(password.val().length<6)
				{	password.parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
					password.parent().next().find("span").addClass('do_tip error_tip');
					password.parent().next().find(".do_tip").html("密码太短");
					return false;
				}
			}		
			
	}
	else
	{
		password.parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
		password.parent().next().find("span").addClass('do_tip error_tip');
		password.parent().next().find(".do_tip").html("不能为空");
		return false;
	}
	if(password.attr('id')!="login_pass")			
	{
		password.parent().next().find("span").removeClass('error_tip ok_tip help_tip');
		password.parent().next().find("span").addClass('do_tip ok_tip');
		password.parent().next().find(".do_tip").html("");
		return false;
	}	
}

function ComparePassword(password1,password2)
{	
	if(password2.val().length>0)
	{
		if (password1.val()!=password2.val())
		{
			password2.parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
			password2.parent().next().find("span").addClass('do_tip error_tip');
			password2.parent().next().find(".do_tip").html("确认有误");
			return false;
		} 
		else
		{
			password2.parent().next().find("span").removeClass('error_tip ok_tip help_tip');
			password2.parent().next().find("span").addClass('do_tip ok_tip');
			password2.parent().next().find(".do_tip").html("");	
		}
	}
	else
	{
		password2.parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
		password2.parent().next().find("span").addClass('do_tip error_tip');
		password2.parent().next().find(".do_tip").html("不能为空");
		return false;
	}
	
}
function CheckYzm(yzm)
{	
	if(yzm.val().length==0)
	{
		yzm.parent().parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
		yzm.parent().parent().next().find("span").addClass('do_tip error_tip');
		yzm.parent().parent().next().find(".do_tip").html("不能为空");
		return false;
	}
		/*yzm.parent().parent().next().find("span").removeClass('error_tip ok_tip help_tip');
	 	yzm.parent().parent().next().find("span").addClass('do_tip ok_tip');
        yzm.parent().parent().next().find(".do_tip").html("");*/
}
function checkLoginForm(thisform) 
{	
	
	if($('#login_user').val() =="")
	{		
		$('#login_user').parent().parent().next().find("span").removeClass('error_tip ok_tip help_tip').addClass('do_tip');
		$('#login_user').parent().parent().next().find("span").addClass('error_tip');
	    $('#login_user').parent().parent().next().find("span").html("不能为空");
		$('#login_user').select();
		$('#login_user').focus();
        return false;
	}    
	var filter=/^\s*([A-Za-z0-9_-]+(\.\w+)*@(\w+\.)+\w{2,3})\s*$/;
    if (!filter.test($('#login_user').val())) 
	{ 	$('#login_user').parent().parent().next().find("span").removeClass('error_tip ok_tip help_tip').addClass('do_tip');
		$('#login_user').parent().parent().next().find("span").addClass('error_tip');
     	$('#login_user').parent().parent().next().find("span").html("格式有误");
        return false; 
   	}
		$('#login_user').parent().parent().next().find("span").removeClass('error_tip ok_tip help_tip do_tip');
		$('#login_user').parent().parent().next().find("span").addClass('help_tip');
     	$('#login_user').parent().parent().next().find("span").html("");
	
	if($('#login_pass').val().length<=0)	
	{
		$('#login_pass').parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
		$('#login_pass').parent().next().find("span").addClass('do_tip error_tip');
		$('#login_pass').parent().next().find(".do_tip").html("不能为空");
		$('#login_pass').select();
		$('#login_pass').focus();
		return false;
	}
		$('#login_pass').parent().next().find("span").removeClass('error_tip ok_tip help_tip do_tip');
		$('#login_pass').parent().next().find("span").addClass('help_tip');
		$('#login_pass').parent().next().find(".do_tip").html("");
	var remember = '';
	if($('#remember').checked){remember = $('#remember').value;}
	
	$.ajax({
	   type: "POST",
	   url: "/usercenter/check",
	   data: 'act=check_login_info&username=' + $('#login_user').val() + '&password=' + $('#login_pass').val() + '&m=' + Math.random(),
	   success:function(msg){
    	    if(msg == 0)
    	    {
    	        //alert('用户名或密码错误');
				thisform.find('input:button').eq(0).parent().find("span").eq(0).removeClass('error_tip ok_tip help_tip').addClass('do_tip');
				thisform.find('input:button').eq(0).parent().find("span").eq(0).addClass('error_tip');
    			thisform.find('input:button').eq(0).parent().find("span").eq(0).html("Email或密码错误！");
    	    }
    	    else
    	    {   // alert($("form:is(#loginForm)").attr('id')+" "+$("form:is(#loginForm)").attr('action'))   	        
				//$("form:is(#loginForm)").submit(); 
				thisform.find('input:button').eq(0).parent().find("span").eq(0).removeClass('error_tip ok_tip help_tip do_tip');
				thisform.find('input:button').eq(0).parent().find("span").eq(0).addClass('help_tip');
    			thisform.find('input:button').eq(0).parent().find("span").eq(0).html("");
				thisform.submit(); 
				
    	    }
	   }
	  });
	
	
	
}
function checkSignupForm(thisform) {
  
	if($('#email').val() =="")
	{		
		$('#email').parent().parent().next().find("span").removeClass('error_tip ok_tip help_tip').addClass('do_tip');
		$('#email').parent().parent().next().find("span").addClass('error_tip');
	    $('#email').parent().parent().next().find("span").html("不能为空");
		$('#email').select();
		$('#email').focus();
        return false;
	}    
	var filter=/^\s*([A-Za-z0-9_-]+(\.\w+)*@(\w+\.)+\w{2,3})\s*$/;
    if (!filter.test($('#email').val())) 
	{ 
		$('#email').parent().parent().next().find("span").removeClass('error_tip ok_tip help_tip').addClass('do_tip');
		$('#email').parent().parent().next().find("span").addClass('error_tip');
     	$('#email').parent().parent().next().find("span").html("格式有误");
        return false; 
   	}

    if($('#email').parent().parent().next().find("span").eq(0).text()=="已被注册"){
     $('#email').focus();
	 $('#email').select();
     return false;
  }

	if($('#password').val().length>0)
	{
		
		if($('#password').val().length<6)
		{	$('#password').parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
			$('#password').parent().next().find("span").addClass('do_tip error_tip');
			$('#password').parent().next().find(".do_tip").html("密码太短");
			return false;
		}
		else
		{
			$('#password').parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
			$('#password').parent().next().find("span").addClass('do_tip ok_tip');
			$('#password').parent().next().find(".do_tip").html("");
		}
	}
	else
	{
		$('#password').parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
		$('#password').parent().next().find("span").addClass('do_tip error_tip');
		$('#password').parent().next().find(".do_tip").html("不能为空");
		$('#password').select();
		$('#password').focus();
		return false;
	}
  
  if ($('#password').val() != $('#conform_password').val()) {
		$('#conform_password').parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
		$('#conform_password').parent().next().find("span").addClass('do_tip error_tip');
		$('#conform_password').parent().next().find(".do_tip").html("确认有误");
		return false;
  }   
  else
  {
	$('#conform_password').parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
	$('#conform_password').parent().next().find("span").addClass('do_tip ok_tip');
	$('#conform_password').parent().next().find(".do_tip").html(""); 
	}
  var agreement = $("#agreement_input");
  var agreementV = '';
  if(agreement.length){
       if(!agreement[0].checked){
        $("#agreement_input").parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
		$("#agreement_input").parent().next().find("span").addClass('do_tip error_tip');
		$("#agreement_input").parent().next().find(".do_tip").html("需同意协议");
       return false;
     }else{
        agreementV = agreement[0].value;		
		$("#agreement_input").parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
		$("#agreement_input").parent().next().find("span").addClass('do_tip ok_tip');
		$("#agreement_input").parent().next().find(".do_tip").html("");
     }
  }
  if ($("#captcha").val() == '' )
  {
    $("#captcha").parent().parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
	$("#captcha").parent().parent().next().find("span").addClass('do_tip error_tip');
	$("#captcha").parent().parent().next().find(".do_tip").html("不能为空");
	$("#captcha").select();
	$("#captcha").focus();
    return false;
  }
  
  $.ajax({
	   type: "POST",
	   url: "/usercenter/check",
	   data: 'act=check_captcha&captcha=' + $('#captcha').val() + '&m=' + Math.random(),
	   success:function(msg){
    	    if(msg == 0)
    	    {
				$("#captcha").parent().parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
				$("#captcha").parent().parent().next().find("span").addClass('do_tip error_tip');
				$("#captcha").parent().parent().next().find(".do_tip").html("验证码不正确");
    	        return false;
    	    }else if(msg == -1)
    	    {
    	        $("#captcha").parent().parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
				$("#captcha").parent().parent().next().find("span").addClass('do_tip error_tip');
				$("#captcha").parent().parent().next().find(".do_tip").html("不能为空");
				$("#captcha").select();
				$("#captcha").focus();
				return false;
    	    }
    	    else
    	    {	//alert($("form:is(#formUser)").attr('id')+" "+$("form:is(#formUser)").attr('action'))   	
				//$("form:is(#formUser)").submit(); 
				$("#captcha").parent().parent().next().find("span").removeClass('do_tip error_tip ok_tip help_tip');
				$("#captcha").parent().parent().next().find("span").addClass('do_tip ok_tip');
				$("#captcha").parent().parent().next().find(".do_tip").html("");
				thisform.submit(); 
    	    }
	   }
	  });
  
  
}
</script>

<!--此处新feature见cart.txt-->
    
      <script type="text/javascript">
  inToCartAction = function (good_id, good_name, isRefesh) {
    var gs  = 2;//parseInt($(".gs").val());
    var gns = 1;//parseInt($("#goods_num_input").val());

    if (gns == 0)
    {
        alert("请选择够数个数。");
    }
    else if(gs < gns)
    {
        alert("数量超出库存，请重新填写。");
    }
    else
    {
        inTooCartAction(good_id, good_name,isRefesh);
    }
}

function inTooCartAction(goodsId, goodsName, isRefesh, parentId) {
    var goods = new Object();
    var spec_arr = new Array();
    var fittings_arr = new Array();
    var select = "";
    var p = parentId == "" ? false: true;
    var number = 1;//parseInt($("#goods_num_input").val());
    var refresh = 0;
    if (isRefesh) {
        refresh = 1
    }
    if ($("#goods_type_select")) {
        select = $("#goods_type_select").value
    }
    goods = '{"spec": "","select": "' + select + '", "goods_id":"' + goodsId + '", "number": "' + number + '","parent": "0"}';
    $.ajax({
        type: "POST",
        url: "/shopping/check?step=add_to_cart",
        data: "goods=" + goods,
        success: GoodsInsertToCartResponse,
        complete: function(XMLHttpRequest, status) {
            result = eval("(" + XMLHttpRequest.responseText + ")");
            if (!result.error) {
                if (refresh == 1) {
                    windowMessage(goodsName)
                    //location.reload()
                } else {
                    //windowMessage(goodsName)
                    window.location="/shopping/cart";
                }
            } else {
                if (result.error == 2) {
                    if (confirm(result.message)) {
                        location.href = "user.php?act=add_booking&id=" + result.goods_id
                    }
                } else {
                    if (result.error == 6) {
                        if (confirm(result.message)) {
                            location.href = "goods.php?id=" + result.goods_id
                        }
                    } else {
                        alert(result.message)
                    }
                }
            }
        }
    })
}

</script>    
    
      <div class="trinket_title" id="trinket_title" > <span></span>
  <ul id="trinket_bar">
        <li class="trinket_bar trinket_bar_on">10元以下</li>
        <li class="trinket_bar">10元-30元</li>

        <li class="trinket_bar">30元-50元</li>
    </ul>
</div>
<div class="trinket_box">
  <div class="switch_item" >
<%Product.below_10.each do |product|%>
      <ul>
      <li><a href="<%=product_url(product.id)%>" target="_blank"><img src="<%=product.i1.url(:small)%>" alt="<%=product.name%>" width="100" height="100" /></a></li>
      <li><a href="<%=product_url(product.id)%>" target="_blank" title="<%=product.name%>"><%=truncate product.name,:length=>12%></a></li>
      <li><span>￥<%=price(product.p2)%></span></li>

      <li><a href="javascript:inToCartAction('<%=product.id%>','<%=product.name%>')"><img src="/themes/default/imgs/flow/putin_btn.gif" width="100" height="22" /></a></li>
    </ul>
<%end%>
      <div class="clear"></div>
  </div>
  <div class="switch_item" style="display:none;">
<%Product.between_10_and_30.each do |product|%>
      <ul>
      <li><a href="<%=product_url(product.id)%>" target="_blank"><img src="<%=product.i1.url(:small)%>" alt="<%=product.name%>" width="100" height="100" /></a></li>
      <li><a href="<%=product_url(product.id)%>" target="_blank" title="<%=product.name%>"><%=product.name%></a></li>
      <li><span>￥<%=price(product.p2)%></span></li>

      <li><a href="javascript:inToCartAction('<%=product.id%>','<%=product.name%>')"><img src="/themes/default/imgs/flow/putin_btn.gif" width="100" height="22" /></a></li>
    </ul>
<%end%>
      <div class="clear"></div>
  </div>

  <div class="switch_item" style="display:none;">
<%Product.above_50.each do |product|%>
      <ul>
      <li><a href="<%=product_url(product.id)%>" target="_blank"><img src="<%=product.i1.url(:small)%>" alt="<%=product.name%>" width="100" height="100" /></a></li>
      <li><a href="<%=product_url(product.id)%>" target="_blank" title="<%=product.name%>"><%=product.name%></a></li>
      <li><span>￥<%=price(product.p2)%></span></li>

      <li><a href="javascript:inToCartAction('<%=product.id%>','<%=product.name%>')"><img src="/themes/default/imgs/flow/putin_btn.gif" width="100" height="22" /></a></li>
    </ul>
<%end%>
      <div class="clear"></div>
  </div>
</div>
<script type="text/javascript" charset="utf-8">
$(document).ready(function(){
   $('#trinket_bar').find('li').click(function(){
      $(this).addClass('trinket_bar_on').siblings().removeClass('trinket_bar_on');									  
      $('.trinket_box').find('.switch_item').eq($('#trinket_bar').find('li').index(this)).fadeIn().siblings().hide();	
    }, function(){
  });
});
</script>

    
  </div>